<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Soil and Plant Science Division Staff">
<meta name="dcterms.date" content="2024-05-07">

<title>NASIS Basic Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="query-load_files/libs/clipboard/clipboard.min.js"></script>
<script src="query-load_files/libs/quarto-html/quarto.js"></script>
<script src="query-load_files/libs/quarto-html/popper.min.js"></script>
<script src="query-load_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="query-load_files/libs/quarto-html/anchor.min.js"></script>
<link href="query-load_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="query-load_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="query-load_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="query-load_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="query-load_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner {
        background: #19567B;
      }
</style>


</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">NASIS Basic Training</h1>
            <p class="subtitle lead">Querying and Loading Data</p>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Soil and Plant Science Division Staff </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              USDA-NRCS
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 7, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#exercise-3.1-query-and-load-data" id="toc-exercise-3.1-query-and-load-data" class="nav-link active" data-scroll-target="#exercise-3.1-query-and-load-data">Exercise 3.1 – Query and Load Data</a>
  <ul class="collapse">
  <li><a href="#query-against-national-database" id="toc-query-against-national-database" class="nav-link" data-scroll-target="#query-against-national-database">Query Against National Database</a></li>
  <li><a href="#accept-the-data-into-your-local-database" id="toc-accept-the-data-into-your-local-database" class="nav-link" data-scroll-target="#accept-the-data-into-your-local-database">Accept the Data into your Local Database</a></li>
  <li><a href="#query-against-the-local-database" id="toc-query-against-the-local-database" class="nav-link" data-scroll-target="#query-against-the-local-database">Query Against the Local Database</a></li>
  <li><a href="#submit-screenshot" id="toc-submit-screenshot" class="nav-link" data-scroll-target="#submit-screenshot">Submit Screenshot</a></li>
  </ul></li>
  <li><a href="#exercise-3.2-find-and-load-related-data" id="toc-exercise-3.2-find-and-load-related-data" class="nav-link" data-scroll-target="#exercise-3.2-find-and-load-related-data">Exercise 3.2 – Find and Load Related Data</a>
  <ul class="collapse">
  <li><a href="#find-related-data" id="toc-find-related-data" class="nav-link" data-scroll-target="#find-related-data">Find Related Data</a></li>
  <li><a href="#load-related-data" id="toc-load-related-data" class="nav-link" data-scroll-target="#load-related-data">Load Related Data</a></li>
  <li><a href="#download-related" id="toc-download-related" class="nav-link" data-scroll-target="#download-related">Download Related</a></li>
  <li><a href="#submit-screenshots" id="toc-submit-screenshots" class="nav-link" data-scroll-target="#submit-screenshots">Submit Screenshots</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="exercise-3.1-query-and-load-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3.1-query-and-load-data">Exercise 3.1 – Query and Load Data</h2>
<section id="query-against-national-database" class="level3">
<h3 class="anchored" data-anchor-id="query-against-national-database">Query Against National Database</h3>
<p>Open the queries tab in the table of contents on the left side of the NASIS client. Expand the NSSC Pangaea folder by clicking the right facing triangle to the left of the folder icon and locate and select the query named “Area/Legend by areasymbol”. Run the query against the national database by either right clicking and selecting the option available in the context menu or use the button on the toolbar.</p>
<p>Why is it important to run against the national database first? Write your answer down and keep it to send to your mentor.</p>
<p>In this particular query, by default the target table <strong>legend</strong> is selected, and cannot be changed. All objects are also already selected by default in this case. Leave them checked. Area Type Name and Area Symbol are blank and need information entered in order for the query to run.</p>
<p>Click the Run button now to see what happens when you try and run it without entering any information. What do you notice?</p>
<p>Now fill in the query. Use Area Type Name: <strong>Test</strong> and use Area Symbol: <strong>Test</strong></p>
<p>After running a query against the national database, you will see the local database view. This is where we can manage the data we have stored locally. If you have already used NASIS before the training and loaded data into your local database, you may already see data here. Notice each object in NASIS has its own tab. You can click the tabs to explore the local database data.</p>
<p>How many legends were found using your query? How many sites? Where can you find this information?</p>
</section>
<section id="accept-the-data-into-your-local-database" class="level3">
<h3 class="anchored" data-anchor-id="accept-the-data-into-your-local-database">Accept the Data into your Local Database</h3>
<p>If you have a significant amount of data in your local database already, you might want to clear your local database for this course. To do this select the “Clear Local Database” button. If you do, you will need to run the previous query again. On the legend tab select the row with the Rec ID = 17013. Notice you can use sorting and the auto filter row in this view but not the filter editor.</p>
<p>After selecting the row click the “Exclude” button. What do you see different in the “Location” column?</p>
<p>Use the Exclude or Include buttons to further refine the results of your query and customize the data that will go into your local database. Now click the “Accept” button. This downloads the national data into your local database.</p>
</section>
<section id="query-against-the-local-database" class="level3">
<h3 class="anchored" data-anchor-id="query-against-the-local-database">Query Against the Local Database</h3>
<p>In order to fully explore and edit data you need to query your local data and put it in your selected set. Do this by highlighting the same query used previously and this time select “Run Against Local Database”.</p>
<p>Notice the slight difference from when you ran the query against the national database. We are only shown a list of target tables. The query description can provide additional information, in this case you can see it indicates you should set the target tables to <strong>Area</strong> and <strong>Legend</strong> when running the query locally. Select them now above. Now enter the same information as you used previously and run the query.</p>
<p>How many records were selected for the legend table this time? The Results window that appears will tell you and ask you to confirm if you would like to add these to your selected set. Click yes. Now open your Legend table to view the legend data added to your selected set.</p>
</section>
<section id="submit-screenshot" class="level3">
<h3 class="anchored" data-anchor-id="submit-screenshot">Submit Screenshot</h3>
<p>Submit the screenshot of the data in the legend table and the answer to the questions above and placing them in your exercise submission folder to complete the exercise.</p>
<p><strong>End of Exercise</strong></p>
</section>
</section>
<section id="exercise-3.2-find-and-load-related-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3.2-find-and-load-related-data">Exercise 3.2 – Find and Load Related Data</h2>
<section id="find-related-data" class="level3">
<h3 class="anchored" data-anchor-id="find-related-data">Find Related Data</h3>
<p>This exercise uses the data you queried into your selected set from exercise 3.1.</p>
<p>The find related button can be used to locate data which has a specific relationship to other data which is linked in the database by references to record ids of other data. Select the legend in the legend table and click the Find Related for Selected Row button.</p>
<p><img src="3-2-find-related.png" class="img-fluid"></p>
<p>A window appears, Use the drop-down button to select the target table containing the data you want to find, for this exercise, select <strong>Area</strong> and click ok. The choices in the drop-down menu will differ based on the table you are viewing and will only show choices for data having an existing relationship with the data in the table you are viewing.</p>
<p>You will notice the NASIS client will switch to the table containing the data and highlight the row of the related data. If the related table is not already open it will open it. It will also provide additional information in the status messages window and will show the original table, target table and provide the row id of the original row and related row. You can click these links in the status window to return to either the original or the related row. Take a screenshot of the Area table and save to send to your mentor.</p>
<p><img src="3-2-find-status.png" class="img-fluid"></p>
</section>
<section id="load-related-data" class="level3">
<h3 class="anchored" data-anchor-id="load-related-data">Load Related Data</h3>
<p>When you have data loaded into your selected set, you can also load related data from the local database into the selected set using the load related for selected rows button:</p>
<p><img src="3-2-load-related.png" class="img-fluid"></p>
<p>Return to the Legend table and select the legend by clicking the row to highlight it. Click on the load related button and click on the down arrow to select NASIS User.</p>
<p><img src="3-2-load-related-win.png" class="img-fluid"></p>
<p>If the data is in the local database, you will see a window confirming your results:</p>
<p><img src="3-2-load-related-result.png" class="img-fluid"></p>
<p>Click yes to add the results to your selected set. Notice you will need to open the NASIS User table to see the results of the load related action. Alternatively, you can also use the find related action. Take a screenshot of the NASIS User table and save to send to you mentor.</p>
<p>If no related records were found, you will see a different results window similar to this one:</p>
<p><img src="3-2-load-related-no-result.png" class="img-fluid"></p>
<p>Remember this tool only works if the data exists and is in your local database. If it doesn’t return results do not assume there isn’t any related data – there might be related data, it just isn’t in your local database to load into your selected set.</p>
</section>
<section id="download-related" class="level3">
<h3 class="anchored" data-anchor-id="download-related">Download Related</h3>
<p>The download related button can be used in instances where you see “NOT IN LOCAL DATABASE” in the columns where data should be loaded. This situation could occur if you queried data from the national database, but did not choose to download all the related tables at the time of the query. To demonstrate this tool, we will need to remove some data from our local database. Click the “Setup Local Database” button to open the local database view:</p>
<p><img src="3-2-setup-local.png" class="img-fluid"></p>
<p>Click the mapunit tab and select Rec ID = 2761935, then click the exclude button, and then accept button.</p>
<p>Now return to the legend table view. Expand the legend table to see the child tables by clicking the plus icon on the left. Notice there is a row that has “NOT IN LOCAL DATABASE” showing in some of the columns:</p>
<p><img src="3-2-not-in-local.png" class="img-fluid"></p>
<p>This corresponds to the row we just removed from our local database. To add it back to your local database select the row and use the download related button:</p>
<p><img src="3-2-download-related.png" class="img-fluid"></p>
<p>A window will appear where you can confirm the request. Take a screenshot of this window and save to send to you mentor. You can also choose to add the data to your selected set by checking the box. Even though you might see the download related button is active on the toolbar, not all data is downloadable because it is not required unless you see “NOT IN LOCAL DATABASE” in the rows/columns where data should be. If the download related button does not work, then you will have to run a new query against the national database to get the data.</p>
</section>
<section id="submit-screenshots" class="level3">
<h3 class="anchored" data-anchor-id="submit-screenshots">Submit Screenshots</h3>
<p>Submit your screenshots by placing them in your exercise submission folder to complete the exercise.</p>
<p><strong>End of Exercise</strong></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>